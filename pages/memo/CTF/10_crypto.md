---
layout: page
title: crypto
toc: true
---

## crypto

　暗号解読とか

## 暗号解読

　古典暗号・近代暗号では、暗号アルゴリズムと暗号鍵を秘匿としていた。

　現代暗号では、暗号アルゴリズムは公開されており、暗号鍵だけを秘匿にするのが一般的。

　解読の基本はブルートフォース。

　古典暗号・近代暗号では統計学的アプローチとしての頻度分析が有効。

　現代暗号においては、如何に探索対象を減らすアルゴリズムを作りだせるかが焦点。頻度分析等で暗号文の規則性を探すよりも、暗号アルゴリズムをよく理解することが近道。問題点を発見するか有効アルゴリズムを思いつくかの二択。

| 分類 | 秘密 | 解読 |
| 古典暗号 | ・暗号アルゴリズム<br>・暗号鍵 | 頻度分析 |
| 近代暗号<br>（機械式） | ・暗号アルゴリズム<br>・暗号鍵 | 頻度分析 |
| 現代暗号 | 暗号鍵 | ・暗号法の問題点を見つける<br>・暗号法に対して有効なアルゴリズムの構築 |
| 物理暗号 |  |  |

## 古典暗号
　`Hello` を暗号化した例も載せる。

| 古典暗号 | 種別 | 時代 | Hello | キー |
|---|---|---|---|---|
| ポリュビオス<br>の暗号表 | 換字式（単表、単一） | 古代ギリシア | 23 15 31 31 34 | - |
| シーザー暗号 | 換字式（単表、単一） | 古代ローマ | Ebill | 3 |
| ヴィジュネル暗号 | 換字式（多表） | 15,16世紀<br>フランス | Rijvs | key |
| ADFGVX暗号 | ポリュビオス<br>の暗号表 + 転置式 | WWIドイツ | VFFADVFXXG | knowledge |
| ROT13 | 換字式（単表、単一） | 1980年代 | Aryyb | 13 |

### ポリュビオスの暗号表

|   | 1 | 2 | 3 | 4 | 5 |
|:-:|:-:|:-:|:-:|:-:|:-:|
| **1** | A | B | C | D | E |
| **2** | F | G | H | I , J | K |
| **3** | L | M | N | O | P |
| **4** | Q | R | S | T | U |
| **5** | V | W | X | Y | Z |

```
平文　: Hello
鍵　　: -
暗号文: 23 15 31 31 34
```

### シーザー暗号

```
通常　: ABCDEFGHIJKLMNOPQRSTUVWXYZ
暗号化: XYZABCDEFGHIJKLMNOPQRSTUVW
```

　いわゆる ROT3 である。3でなくても良いらしい。

```
平文　: Hello
鍵　　: 3
暗号文: Ebiil
```

### ヴィジュネル暗号

　はみ出したけどしょうがない。

| |A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
|**A**|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|
|**B**|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|
|**C**|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|
|**D**|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|
|**E**|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|
|**F**|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|
|**G**|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|
|**H**|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|
|**I**|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|
|**J**|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|
|**K**|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|
|**L**|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|
|**M**|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|
|**N**|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|
|**O**|O|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|
|**P**|P|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|
|**Q**|Q|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|
|**R**|R|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|
|**S**|S|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|
|**T**|T|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|
|**U**|U|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|
|**V**|V|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|
|**W**|W|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|
|**X**|X|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|
|**Y**|Y|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|
|**Z**|Z|A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|

　鍵は任意のもので良い。今回は key としてみる。

```
平文　: Hello
鍵　　: key
暗号文: Rijvs
```

- H - k -> R
- e - e -> i
- l - y -> j
- l - K -> v
- o - e -> s

　このように鍵(key)が繰り返される。

### ADFGVX暗号

1. ポリュビオスの暗号表と同じ原理による暗号化（第一暗号文）
2. 転置式による暗号化（第二暗号文）

　まず、表を a~z, 0~9 の36文字でランダムに埋める。

|   | A | D | F | G | V | X |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| **A** | d | h | x | m | u | 4 |
| **D** | p | 3 | j | 6 | a | o |
| **F** | i | b | z | v | 9 | w |
| **G** | 1 | n | 7 | 0 | q | k |
| **V** | f | s | l | y | c | 8 |
| **X** | t | r | 5 | e | 2 | g |

　これを用いて第一暗号文を作る。

```
平文　　　: Hello
鍵　　　　: -
第一暗号文: AFXGVFVFDX( AF XG VF VF DX )
```

　次に転置式暗号化を行うために鍵を定める。今回は鍵を knowledge としてみる。

　knowledge から重複文字を消して knowledg とする。

　アルファベット順に数字を割り振ると knowledg は 46785213 となり、これが転置鍵である。

　そして、第一暗号文を転置鍵サイズ（8文字）で改行して表に書き出す。

|4|6|7|8|5|2|1|3|
|-|-|-|-|-|-|-|-|
|A|F|X|G|V|F|V|F|
|D|X| | | | | | |

　この表の数字の順に縦に読み出すと第二暗号文が得られる。

```
第一暗号文: AFXGVFVFDX( AF XG VF VF DX )
鍵　　　　: knowledg
転置鍵　　: 46785213
第二暗号文: VFFADVFXXG( V F F AD V FX X G )
```

　ややこしいけど、出来た。

### ROT13

```
通常　: ABCDEFGHIJKLMNOPQRSTUVWXYZ
暗号化: NOPQRSTUVWXYZABCDEFGHIJKLM
```

　13個ずれている。

```
平文　: Hello
鍵　　: 13
暗号文: Aryyb
```

## 近代暗号（機械式暗号）

　機械で作る暗号。その根底は古典暗号と変わらない。古典暗号に比べて、複雑な手順かつ高速になっただけとも言える。人力での解読は古典暗号と比較すると困難の極みと言える。

### エニグマ

　一文字ずつ異なる換時表を用いる暗号。

　平文を打ち込むと、ローターが一目盛り回転し、回路が変化する（換時表が変わる）。

　また、プラグボードによって文字を交換できるため、プラグボードの指し方によっても変化する（換時表が変わる）。

- ローターの初期パターン
  - 初期3つ
  - 後期には5つから3つ選ぶ
- プラグボードの組み合わせ（「A」と「J」にケーブルを指すと、文字が入れ替わる）
  - 初期3つ
  - 後期10つ

　ローターの初期パターンとプラグボードの組み合わせによって作られた換時表の数は膨大なものになる。後期にはさらに数が増えている。

　古典暗号を量的な側面で難度をあげたの近代暗号（機械式暗号）。頻度分析では追いつかない。初期パターンの配置情報の取得と機械によるブルートフォースが攻略の鍵となった。

#### 戦争時の利用法
　復号する際には、暗号化した時の初期ローターの文字を合わせて、暗号文を打ち込むことで復号出来る。

　この仕組みのため、初期ローター文字を共有する必要があり、通信時の最初6文字はその共有に使われていた。

　ローターは3つあり、「SEP」を初期としたとき、「SEP SEP」を暗号化した「GED OSO」を文頭に付けていたわけである。

#### 暗号化側

1. 初期位置「AAA」
2. 鍵（設定）を定める「SEP」
3. 鍵を二度打ち込む「SEP SEP」と暗号化され「GED OSO」となり、メッセージの文頭にこれを付けて送る
4. 初期位置を「SEP」（設定）にして、平文を暗号化する。

#### 復号側

1. 初期位置「AAA」
2. 文頭で送られてきた「GED OSO」を打ち込むと「SEP SEP」に復号される
3. 初期位置を「SEP」（設定）にして、暗号文を復号化する。

## 現代暗号

　現代暗号になると、暗号アルゴリズムは公開され、暗号鍵を非公開にして運用する方針になる。暗号アルゴリズムが分かっても暗号鍵を推測するのが困難な仕組み。

　その意味では、エニグマも、暗号アルゴリズム（換字表の変化）が分かっても、鍵（= 初期配置 = ローター、プラグボード）が不明だと復号が難しいので、現代暗号に近い気もする。ただ、エニグマは暗号ルゴリズムが非公開であったわけで、その事も含めて近代暗号（機械式暗号）と呼ばれるのだろう。

　現代暗号の始まりは DES であるらしい（共通鍵暗号、ブロック暗号の一種）。

| 種別 | 暗号化 | 復号化 | 説明 |
|---|---|---|---|
| 共通鍵暗号 | 共通鍵 | 共通鍵 | 暗号復号の両方に同じ鍵を用いる |
| 公開鍵暗号 | 公開鍵 | 秘密鍵 | 暗号復号に異なる鍵を用いる |

　共通鍵暗号はその仕組みからシーザー暗号（鍵は何文字ずらすか）と同じことが分かる。ただし、シーザー暗号に比べて推測は困難で、鍵（共通鍵）さえ流出しなければ良いという方針に沿っている。このことが現代暗号に分類され所以である。

　暗号アルゴリズムが抱える問題（脆弱性）を突くことで解読できるとかできないとか。暗号文を眺めて頻度分析をする古典暗号ではなく、アルゴリズムを知ることが解読の糸口になるのが現代暗号。

## └ 共通鍵暗号

| 種別 | 処理単位 | 
|---|---|
| ブロック暗号 | 固定長のデータ（ブロック） |
| ストリーム暗号 | ビット・バイト |

<div style="height: 470px; overflow: hidden;"><div style="margin-top:-40px;"><div class="mermaid">
graph TD

subgraph ストリーム信号
    AA[鍵 k] --> BB[[疑似乱数生成器 R]]
    BB --> CC["鍵ストリーム K=R(k)"]
    CC --> DD((XOR))
    EE[平文] --> DD
    DD --> FF[暗号文]
end

subgraph ブロック信号
    A["平文ブロック(P1, P2, ..., Pn)"] --> B[["暗号化アルゴリズム Ci = Ek(Pi)"]]
    C[鍵 k] --> B
    B --> D["暗号文ブロック(C1, C2, ..., Cn)"]
end
</div></div></div>

### ブロック暗号

1. 初期変換
2. ラウンド関数
   - Feistel構造
   - SPN構造
3. 最終変換

<div style="height: 190px; overflow: hidden;"><div style="margin-top:-70px;"><div class="mermaid">
graph LR

subgraph ブロック信号
    AA[平文] --> BB[[初期変換]]
    BB --> CC[[ラウンド関数]]
    CC -.N回.-> DD[[ラウンド関数]]
    DD --> EE[[最終変換]]
    EE --> FF[暗号文]
    aa[鍵] --> bb[[鍵スケジューリング]]
    bb --> cc[拡大鍵]
    cc --> BB
    cc --> CC
    cc --> DD
    cc --> EE
    subgraph データランダム化
        BB
        CC
        DD
        EE
    end
end
</div></div></div>

#### ラウンド関数

Feistel構造

1. サブブロックAをF関数で非線形変換
2. サブブロックBを変換後のAとの排他的論理和によって変換
3. 二つのサブブロックの位置を交換
4. 1から繰り返し

SPN構造

1. 換字変換（ある数値と別のある数値を置き換える）
2. 転置変換（ブロックの bit の位置を置き換える）
3. 1から繰り返し

#### ブロック暗号の利用モード
- ECB(Electronic Codebook)
- CBC(Cipher Block Chaining)
- CFB(Cipher Feedbacck)
- OFB(Output Feedbacck)
- CTR(Counter)

暗号化の時・復号化の時のモード毎の差異。wikiの図が分かりやすいが、ここでは比較を意図。

| Mode | IN-Func (暗) | C (暗) | IN-Func (復) | P (復) |
|---|---|---|---|---|
| ECB | P | OUT-F | C | OUT-F |
| CBC | ・P(+)IV<br>・P(+)OUT-F(n-1) | OUT-F | C | ・OUT-F(+)IV<br>・OUT-F(+)C(n-1) |
| CFB | ・IV<br>・C(n-1) | OUT-F(+)P | ・IV<br>・C(n-1) | OUT-F(+)C<br> |
| OFB | ・IV<br>・OUT-F(n-1) | OUT-F(+)P | ・IV<br>・OUT-F(n-1) | OUT-F(+)C<br> |
| CTR | Nonce + Counter | OUT-F(+)P | Nonce + Counter | OUT-F(+)C |

- P(PlainText): 平文
- C(CipherText): 暗号文
- (+): xor
- IV(Initialization Vector): 初期化ベクトル
- Nonce: 使い捨てのランダムな値
- Counter: 1ずつ増える値
- (n-1): 1つ前
- Func: 暗号化関数
- IN-Func: 暗号化関数の入力
- OUT-F(OUT-Func): 暗号化関数の出力

### ストリーム暗号

疑似乱数生成器の違い。

- LFSR(Linear Feedback Shift Register): 線形帰還シフトレジスタ

気が向いたら詳しく調べる。

## └ 公開鍵暗号
- 素因数分解問題
  - RSA
- 離散対数問題
- ナップサック問題
- ラティス問題

## その他
### デジタル署名
- RSA署名

### 暗号学的ハッシュ関数
- MD2, MD4, MD5
- SHA-0, SHA-1
- SHA-2(SHA-224, SHA-256, SHA-384, SHA-512)
- SHA-3

`The quick brown fox jumps over the lazy dog` を変換した例

| 種 | 変換例 |
|---|---|
| MD2 | 03d85a0d629d2c442e987525319fc471 |
| MD4 | 1bee69a46ba811185c194762abaeae90 |
| MD5 | 9e107d9d372bb6826bd81d3542a419d6 |
| SHA-1 | 2fd4e1c67a2d28fced849ee1bb76e7391b93eb12 |
| SHA-256 | d7a8fbb307d7809469ca9abcb0082e4f8d5651e46d3cdb762d02d0bf37c9e592 |
| SHA-3 | d15dadceaa4d5d7bb3b48f446421d542e08ad8887305e28d58335795 |

### 近いけど何か違うやつ

※暗号化処理ではないけれども、置く場所がないので、一端ここに。

| 名前 | 分類（アルゴリズム） | 関連 |
|---|---|---|
| base64 | エンコーディング | メールソフト |
| uu(uuencode) | エンコーディング | メールソフト |
| gzip | 圧縮 |  |

- 暗号化アルゴリズムは「平文」「暗号文」「鍵」が必要
- 暗号学的ハッシュ関数は「平文」「暗号文」
  - 基本的に「鍵」がない（SHA-256など）
  - 「鍵」を使うのもある（HMACなど）
- この辺は「平文」「暗号文」のみ
  - だが、セキュリティ性能はない。データ伝送用のフォーマットだったりする。

### 疑似乱数器

　を使ったのが、ワンタイムパッド、Nonce など

## 攻撃
- Brute Force Method
  - 全数探索法
  - タイムメモリートレードオフ法
  - 暗号文一致攻撃（誕生日攻撃）
  - 辞書攻撃
- Short Cut Method
  - 差分解読法
  - 線形解読法
  - 高階差分攻撃
  - 補間攻撃
  - 分割攻撃
  - 関連鍵攻撃

### B 全数探索法
　入手した暗号文を候補となる鍵で順々に復号する手法。鍵長が n bit の場合、候補となる鍵の個数は 2^n 個となる。

### B タイムメモリートレードオフ法
　暗号文と平文の対応が分かる索引表を用いる。これは送信される平文を予想可能な場合に利用する。

### B 暗号文一致攻撃（誕生日攻撃）
　「n bit のサイズのデータをランダムに 2^n/2 個集めたときに、その中に同じデータが 2 個以上存在する確率が約 0.5 になる」という性質（バースデー・パラドックスと呼ばれる）を利用した攻撃法。

　同一の鍵によって生成された複数の暗号文の中から一致するものを探し出す。

### B 辞書攻撃
　暗号文と平文のペアを用意して起き辞書のように利用する。

### S 差分解読法
　絞り込み

### S 線形解読法
### S 高階差分攻撃
### S 補間攻撃
### S 分割攻撃
### S 関連鍵攻撃

## RSA暗号




## 付録
- 計算複雑性理論


