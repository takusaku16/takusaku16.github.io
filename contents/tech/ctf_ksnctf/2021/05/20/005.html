<!DOCTYPE html>
<html lang="jp">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ksnctf 005 Onion | 逝く道</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="ksnctf 005 Onion" />
<meta property="og:locale" content="jp" />
<meta name="description" content="どこまでも逝こう。" />
<meta property="og:description" content="どこまでも逝こう。" />
<link rel="canonical" href="/contents/tech/ctf_ksnctf/2021/05/20/005.html" />
<meta property="og:url" content="/contents/tech/ctf_ksnctf/2021/05/20/005.html" />
<meta property="og:site_name" content="逝く道" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-20T12:38:04+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ksnctf 005 Onion" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-05-20T12:38:04+00:00","datePublished":"2021-05-20T12:38:04+00:00","description":"どこまでも逝こう。","headline":"ksnctf 005 Onion","mainEntityOfPage":{"@type":"WebPage","@id":"/contents/tech/ctf_ksnctf/2021/05/20/005.html"},"url":"/contents/tech/ctf_ksnctf/2021/05/20/005.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="逝く道" /><!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y8XBTJHM0K"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Y8XBTJHM0K');
      </script></head> 

  

  <body><header class="site-header" role="banner">

  <div class="wrapper">
    <a class="site-title" rel="author" href="/">逝く道</a>
    
    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger"><a class="page-link" href="/diary/">Diary</a><a class="page-link" href="/tech/">Tech</a><a class="page-link" href="/novel/">Novel</a><a class="page-link" href="/memo/">Memo</a><a class="page-link" href="/junk/">Junk</a><a class="page-link" href="/about/">About</a></div>

    </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ksnctf 005 Onion</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-05-20T12:38:04+00:00" itemprop="datePublished">May 20, 2021
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <details>
        <summary>目次</summary><ul><li><a href="#ksnctf-005-onion">ksnctf 005 Onion</a><ul><li><a href="#謎解き">謎解き</a></li><li><a href="#おまけ">おまけ</a></li></ul></li><li><a href="#所感">所感</a></li></ul></details>
    <h2 id="ksnctf-005-onion">ksnctf 005 Onion</h2>
<ul>
  <li>問題公開日: 2012/05/26</li>
  <li>ジャンル: crypto</li>
</ul>

<h3 id="謎解き">謎解き</h3>

<p>　謎は、問題文である。</p>

<p>　実は紆余曲折あったのだが、それは所感で記すとしよう。</p>

<p>　この問題文を見て、何か気づくことがないだろうか。</p>

<p>　私が気づいたのは以下の2点である。</p>

<ul>
  <li><strong>[a-z][A-Z][0-9] の62種</strong>で構成されている</li>
  <li><strong>一行76文字</strong>である。</li>
</ul>

<p>　これらを元に検索してみたところ、この問題文は <code class="language-plaintext highlighter-rouge">Base64</code> でエンコードされたものであると分かった。</p>

<p>　早速、 Base64 でデコードしてみる。</p>

<p>　デコード結果を見てがっかりした人もいるかもしれない。何も変わっていないように見えるからだ。</p>

<p>　しかし、良く見ると<strong>文字列が短くなっている</strong>ことが分かる。</p>

<p>　私はここで、この問題のタイトルが「Onion」であることを思い出し思い至った。</p>

<p>　<strong>Base64 でエンコードしたテキストをさらに Base64 でエンコードしているのだということに。</strong></p>

<p>　玉ねぎの皮を剥くように Base64 でデコードし続けていくと、新しい文字列にぶつかった。</p>

<p>　新しい文字列は非常に特徴的な文字列であり、調べてみると、 <code class="language-plaintext highlighter-rouge">uuencode</code> というエンコーディング方式であることが分かった。</p>

<p>　<code class="language-plaintext highlighter-rouge">Base64</code> も <code class="language-plaintext highlighter-rouge">uuencode</code> もメールと関連しているエンコーディング方式であり、まず間違いない。</p>

<p>　新しい文字列を uu で decode すると、FLAG が現れて完了。</p>

<p>　Base64であることに気づけるかどうかが全ての焦点であった。</p>

<h3 id="おまけ">おまけ</h3>
<p>　玉ねぎの皮剥きは結構な量があって手作業だと大変だったので一応プログラムを書いた。</p>

<p>　今回も Rust を使ってみた。</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">extern</span> <span class="k">crate</span> <span class="n">base64</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">base64</span><span class="p">::{</span><span class="n">decode</span><span class="p">};</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Base64</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="s">"＜問題文＞"</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">_onion_str</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

    <span class="c1">// uuencode</span>
    <span class="c1">// の良い感じのが見当たらなかったので、ブラウザ等で変換してください。</span>
    <span class="c1">// https://uic.jp/uuencode/</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">get_decode_cipher</span><span class="p">(</span><span class="n">onion_str</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">is_line</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">onion_u8</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nf">decode</span><span class="p">(</span><span class="n">onion_str</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()[</span><span class="o">..</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">onion_string</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from_utf8</span><span class="p">(</span><span class="n">onion_u8</span><span class="nf">.to_vec</span><span class="p">())</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="k">if</span> <span class="o">!</span><span class="n">is_line</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"-----------</span><span class="se">\n</span><span class="s">{}-----------"</span><span class="p">,</span> <span class="n">onion_string</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">onion_string</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="n">onion_string_all</span> <span class="o">=</span> <span class="n">onion_string</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">onion_string_all</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">onion_string_all</span>
<span class="p">}</span>
</code></pre></div></div>

<p>　<code class="language-plaintext highlighter-rouge">true</code> <code class="language-plaintext highlighter-rouge">false</code> については、出力形式を改行付き文字列にするか否かである。 <code class="language-plaintext highlighter-rouge">Base64</code> は改行無しが望ましく、<code class="language-plaintext highlighter-rouge">uuencode</code> については改行が入っている方が望ましかったために、雑に bool 値を入れた。</p>

<p>　<code class="language-plaintext highlighter-rouge">get_decode_cipher</code> を並べているのもなんとか整理したかったのだが、よく分からなかったので、これで良しとした。各自で高みを目指してください。</p>

<h2 id="所感">所感</h2>
<p>　最初はまったく手の付け方が分からなかったが、crypto ということで、腰を据えて頑張るぞと思って古典暗号から洗い直した。結局、公開鍵暗号については調べ切れていないが、無知の時よりは遥かによくなった。</p>

<p>　そこで、問題文を見直してみて、これは<strong>＜暗号文＞</strong>が渡されているだけの問題であると判ずるに至った。</p>

<p>　通常、暗号化においては<strong>＜平文＞＜暗号文＞＜鍵＞</strong>の三つがあり、これに加えて<strong>＜暗号化アルゴリズム＞</strong>も重要となる。</p>

<p>　例えば、<strong>＜暗号文＞＜暗号化アルゴリズム＞</strong>があれば<strong>＜鍵＞</strong>をブルートフォースで仕留めることが可能だ。ショートカット法などアルゴリズムによってはより効率的な解き方があるだろう。</p>

<p>　しかし今回は、<strong>＜暗号文＞</strong>のみであり、何をどうやっても<strong>＜平文＞</strong>に辿り着けない。このことに気付き愕然とした。なぜならば、暗号解読の基本的な要素が不足している、即ちこれは暗号解読とは関係のない解き方をするのではないかとさえ思えてきたからである。</p>

<p>　また、改めて問題文を凝視してみると、どうにも違和感がある。やたら大文字が多いのだ。大文字が多いというのは普通ではない。暗号解読の時に見たいくつかの暗号文は16進数で構成されており大文字よりも数字の方が多かったのだ。問題文はまるでROT13のような古典暗号のようでありながら、そうではない。違和感を抱きつつもこの時は見過ごすしかなかった。</p>

<p>　手詰まりを感じたのだが、 crypto の分類としか思えないわけで、暗号解読について調べ切れていないところさっと見渡してみた。</p>

<p>　「暗号学的ハッシュ関数」という文字が目に入る。</p>

<p>　ハッシュ関数では大文字がこれほど現れない。だから関係ないだろうと高を括っていた。そうは言っても手詰まりなのだから何かしら情報が欲しかった。ぼおっと眺めていくと、「SHA-1」のwikiで衝撃が走る。</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SHA1("The quick brown fox jumps over the lazy dog")
gives hexidecimal: 2fd4e1c6 7a2d28fc ed849ee1 bb76e739 1b93eb12
gives Base64 binary to ASCII text encoding: L9ThxnotKPzthJ7hu3bnORuT6xI=
</code></pre></div>  </div>
</blockquote>

<p>　問題文に類似する文字列。そこには Base64 というエンコーディング方式の存在が記されていた。</p>

<p>　これをきっかけにして、今回の問題文を解くに至った。</p>

<p>　思い返してみると、暗号学的ハッシュ関数では<strong>＜鍵＞</strong>を必要としない（必要とするものもあるらしいが）。基本的に<strong>＜平文＞＜暗号文＞</strong>だけで良いのだ。即ち今回の問題の状況にぴったりと当てはまる。そして、Base64 を始めとするエンコーディング方式も同様の条件を通過する。</p>

<p>　暗号学的ハッシュ関数と一般的な暗号化アルゴリズムを比較すると、やはり別物なのだと改めて思う。明らかに後者の方がセキュリティとして堅牢だろう。</p>

<p>　本文では解説しなかったが一行76文字というのもBase64の、というよりはメールソフトの特徴らしい。正確にはMINEでそう決めたのだそうだ。問題文の一行が76文字であるということを数えたことは無駄ではなく、Base64である確証を強めてくれていた。</p>

<p>　意味不明な文字列であっても、意味付け可能な何かというのはやはり存在している。暗号解読の基礎知識も重要だが、目の前の暗号文の持つ特徴を正しく捉えることも重要だと感じる一問となった。</p>

<p>　とはいえ、ブロック暗号とかも調べたので、そうした問題に早く取り組みたいところではある。</p>

<p>　ところで、古典暗号を調べていた時にビックペン暗号というのに出会った。この暗号はとても美しかったので、良かった皆さんも見てみてくれたらと思います。</p>

<p>　いやはや遠回りをしてしまったが解けて良かった。</p>

<p>　ではではこの辺で。</p>

<p>　</p>

  </div><a class="u-url" href="/contents/tech/ctf_ksnctf/2021/05/20/005.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-text">逝く道 | subscribe <a href="/feed.xml">via RSS</a> |どこまでも逝こう。</div></div>

  </div>

</footer>
</body>

</html>
