---
layout:   post
title:    "ksnctf 003 Crawling Chaos"
date:     2021-05-18 21:38:04 +0900
---

## ksnctf 003 Crawling Chaos
- 問題公開日: 2012/05/24
- ジャンル: web

### 謎解き

　正しい入力をすればFLAGを取得できそうな入力フォームがある。

　F12 を押して devloper tools を開いてソースコードを見てみると、目を疑う光景が広がっていた。

```html
<script>
    (ᒧᆞωᆞ)=(/ᆞωᆞ/),(ᒧᆞωᆞ).ᒧうー=-!!(/ᆞωᆞ/).にゃー,(〳ᆞωᆞ)=(ᒧᆞωᆞ),....
</script>
```

　入力フォームの挙動は javascript で書かれているはずであり、つまりは `<script></script>` にあるはずなのだが、そこには愉快な顔文字が並んでいるだけであった。

　どうして動いているのかさっぱり分からないが、ともかくこれらが javascript と同等の働きをしていると考えないとサイトの挙動を説明できない。取っ掛かりの見当すらつかないのだが、これを解読するのが今回の問題と考えられる。

　カンマ区切りで改行してみると、幾分見やすくなった。

```html
<script>
    (ᒧᆞωᆞ)=(/ᆞωᆞ/),
    (ᒧᆞωᆞ).ᒧうー=-!!(/ᆞωᆞ/).にゃー,
    (〳ᆞωᆞ)=(ᒧᆞωᆞ),
    (〳ᆞωᆞ).〳にゃー=- -!(ᒧᆞωᆞ).ᒧうー,
    ...
</script>
```

　`=` を使っているわけだから、左辺に右辺を代入しているのだろう。

- `(ᒧᆞωᆞ) = (/ᆞωᆞ/)`
- `hoge = 10`

　みたいな関係があると想像してみる。そこでもしやと思った。

　仮に`(ᒧᆞωᆞ)`が変数なのであれば、 `console.log` で値を確認出来るのではないか、と。

```html
<script>
    (ᒧᆞωᆞ)=(/ᆞωᆞ/),
    console.log((ᒧᆞωᆞ)),
    (ᒧᆞωᆞ).ᒧうー=-!!(/ᆞωᆞ/).にゃー,
    console.log((ᒧᆞωᆞ).ᒧうー),
    (〳ᆞωᆞ)=(ᒧᆞωᆞ),
    console.log((〳ᆞωᆞ)),
    (〳ᆞωᆞ).〳にゃー=- -!(ᒧᆞωᆞ).ᒧうー,
    console.log((〳ᆞωᆞ).〳にゃー),
    ...
</script>
```

　入れてみるとなんだかバカなことをやっているんじゃないかと思えてきたのだが、なんと正解だったのだからもうどうにでもなれである。

　出力結果は以下である。

```javascript
/ᆞωᆞ/
-0
/ᆞωᆞ/
1
...
```

　console.log が効いたので、変数という事で良さそうだ。というわけで片っ端から console.log で出力してみたところ、現れた。

　`(ᒧᆞωᆞ).ᒧうーｰｰｰー` の中身は以下の `javascript` であった。

```javascript
$(function(){
    $("form").submit(function(){
        var t = $('input[type="text"]').val();
        var p = Array(70,152,195,284,475,612,791,896,810,850,737,1332,1469,1120,1470,832,1785,2196,1520,1480,1449);
        var f = false;
        if(p.length == t.length){
            f = true;
            for(var i=0; i < p.length; i++) if( t.charCodeAt(i)*(i+1) != p[i]) f = false;
            if(f) alert("(」・ω・)」うー!(/・ω・)/にゃー!");
        }if(!f) alert("No");
        return false;
    });
});
```

　良く良く見れば、`<head></head>` で JQuery を読み込んでいたわけで、ちゃんと使っていたわけである。ここまで来てもいろいろ信じられないことが多いのだが、とにかくここまで来た。

　フォームを押した時の挙動が記されており、配列pから生成した値と入力値が全文字で一致したら`うーにゃー`のアラートを出してくれるらしい。

　おそらく、その入力値がフラグなのだろう。

　これでやることが明確になった。

### 解く

```javascript
for(var i=0; i < p.length; i++) if( t.charCodeAt(i)*(i+1) != p[i]) f = false;
```

　入力した文字を一文字ずつ(t)に対して、 `t.charCodeAt(i)*(i+1)` の計算をした値が `p[i]` と一致すれば良い。

　従って、以下のように変形していける。

- `t.charCodeAt(i)*(i+1) == p[i]` : 両辺を (i+1) で割る ↓
- `t.charCodeAt(i) == p[i] / (i+1)` : 両辺を charCode で割る（？）的な ↓
- `t = String.fromCharCode(p[i] / (i+1))` : 完成。

　即ち、p配列の要素全てに上記の計算を行った値を出力すれば謎が解けるはずである。

```javascript
var p = Array(70,152,195,284,475,612,791,896,810,850,737,1332,1469,1120,1470,832,1785,2196,1520,1480,1449);
for(var i=0; i < p.length; i++){
    console.log( `? = ${p[i]} / ${(i+1)} = ${p[i] / (i+1)} : ${String.fromCharCode(p[i] / (i+1))}` );
}
```

　出力結果は想定通りの結果だった。FLAGが出てきて、クリア。

## 所感

　謎は解けたが、うーにゃーで `javascript` と同等の機能になっているという謎は未だ分かっていない。調べようにも調べ方が分からない。

　この問題に含まれていた謎は、二つだろう。

- うーにゃーがjavascriptと同等の機能を実現していること
- 逆算の仕方

　2つ目は数式の変換だけでありそれほど苦ではなかったが、1つ目は一種の閃きに助けられた。

　規則性を見出す点は crypto に近かったから、web問らしさはないのかもしれない。

　web問というのはネットワークパケットを解析したりするのだろうか、さてわからない。

　ともかくこれで2問目だ。実質3問目ということで良いか。

　うーにゃーの謎を残したが、先へ進もうと思う。

　FLAGを取る感覚が随分と分かってきた気がする。この調子で次もぱぱっと解いてしまおう。いざ。